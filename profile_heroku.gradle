ext.props = new Properties()

task setEnv {
    def herokuFile = new File("src/main/resources/heroku.properties")
    def jdbcURL= "jdbc:postgresql://" + System.getenv("HEROKU_DB_PG_HOST") + ":" + System.getenv("HEROKU_DB_PG_PORT") + "/" + System.getenv("HEROKU_DB_PG_NAME") + "?user=" + System.getenv("HEROKU_DB_PG_USER") + "&password=" + System.getenv("HEROKU_DB_PG_PASSWORD") + "&ssl=true&sslfactory=org.postgresql.ssl.NonValidatingFactory"

    herokuFile.write("postgresqlUrl=" +  jdbcURL +
            "\npostgresqlUsername=" + System.getenv("HEROKU_DB_PG_USER") +
            "\npostgresqlPassword=" + System.getenv("HEROKU_DB_PG_PASSWORD") +
            "\noktaCertificate=" + System.getenv("OKTA_CERTIFICATE") +
            "\noktaRedirect=" + System.getenv("OKTA_REDIRECT") +
            "\noktaApiKey=" + System.getenv("OKTA_API_KEY") +
            "\noktaUrl=" + System.getenv("OKTA_URL") +
            "\noktaEntityId=" + System.getenv("OKTA_ENTITY_ID"))

    props.load(new FileInputStream("src/main/resources/heroku.properties"))
}

task stage(dependsOn: ["clean", "flywayMigrate", "war", "copyToLib"])
